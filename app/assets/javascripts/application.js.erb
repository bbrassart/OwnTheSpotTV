// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or any plugin's vendor/assets/javascripts directory can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file.
//
// Read Sprockets README (https://github.+com/rails/sprockets#sprockets-directives) for details
// about supported directives.
//

//= require jquery
//= require materialize-sprockets
//= require jquery_ujs
//=require leaflet-src
//= require turbolinks
//= require_tree .
//= require turbolinks


$(document).on('page:change', function() {
  //Materialize JS init

  $('select').material_select();
  $('.dropdown-toggle').dropdown();
  $(".button-collapse").sideNav();
  $(".dropdown-button").dropdown();
  $('.collapsible').collapsible({
    accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
  });

  //Main JS files init

  var listenToSpotsDropdown = new SpotDropdown();
  var mapboxAccessToken = "<%= ENV['MAPBOX_ACCESSTOKEN'] %>";
  var mapboxId = "<%= ENV['MAPBOX_ID'] %>";
  var listenToMap = new mapObject(mapboxAccessToken, mapboxId);

  //Flash messages

  function fadeAlert(){
    $('.alert-temp').removeClass('in');
  }
  function removeAlert(){
    $('.alert-temp').fadeOut("slow");
  }
  window.setTimeout(fadeAlert,1000);
  window.setTimeout(removeAlert,5000);
  if ($('.danger').length) {
    var content = $('.danger').text();
    Materialize.toast(content, 3000, 'rounded danger--notif');
  }
  if ($('.success').length) {
    var content = $('.success').text();
    Materialize.toast(content, 3000, 'rounded success--notif');
  }
});

//Dealing with Insta loading

var ready;
ready = function() {
  window.instgrm.Embeds.process();
};

$(document).ready(ready);
$(document).on('page:load', ready);
